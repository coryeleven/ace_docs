混合云容灾
    跨云备份：本地数据上云、归档，提升数据可靠性
        （挑战：数据风险高，投入大，运维管理难）
        （优点：降低TCO（Total Cost of Ownership，TCO）,提升业务可靠性和连续性）
        应用场景：1、本地数据备份到云上，备份到OBS；2、数据分级备份上云；3、云内测试或演练恢复

    跨云容灾： IT系统应用上云容灾的整体结局方案，IT系统部署在本地IDC，容灾系统部署在公有云
        （数据库容灾、 应用容灾、虚拟化容灾等）

    云上容灾：跨AZ、跨Region、两地三中心三大容灾场景；IT系统与容灾系统都在云上
        云上两地三中心（业务系统部署在同一Region不同的AZ,容灾系统部署在另外一个Region）,使用跨AZ的复制能获利，结合跨Region的容灾能力
        数据库容灾： 云下为业务系统，云上提供容灾服务


冷备容灾(分钟级RPO，小时级RTO)
    应用与数据库容灾系统部署在云上，数据库进行主备容灾，平时服务不启动,业务系统发生故障时，需要先启动容灾系统所使用的云服务器，再将业务切换到容灾系统上运行

    
    应用级冷备（持久化数据涉及到的资源提前申请好，并同步应用数据到容灾region），这套环境日常不启动）
        容灾环境搭建：
            部署架构与生成环境保持一致，并同步应用数据导容灾Region
        容灾演练与切换：  
            容灾环境平常不启动，容灾环境的域名和生产环境的域名一致，在灾难情况下通过切换IP，将流量切换到容灾环境
        业务侧要求：
            1、配置信息不能写IP
            2、不建议Redis当本地数据库使用
            3、不用应用需要使用不同的数据库
            4、业务对自身的容灾有效性负责（包括：容灾环境搭建、数据备份、容灾演练与切换）
            5、在灾难/故障场景切换下应用有数据补录的方案


热备容灾（秒级RPO,分钟级RTO）
    应用与数据库容灾系统部署在云上，数据库进行主备容灾，容灾系统所使用的云服务器平时处于运行状态，容灾系统具备提供业务支撑能力的状态（可根据需要选择容灾系统是否对外提供服务）。业务系统发生故障时，可将业务直接切换到容灾系统上运行，
    
    1、DNS切换，修改DNS解析
    2、应用服务器数据实时同步
    3、数据库数据同步（通过数据库原生的复制技术进行数据同步，也可以第三方的软件对数据库进行复制。）
    4、容灾切换（当业务系统发生故障时，可通过人工方式或通过第三方软件，进行数据库主备切换，并将用户的访问流量全部引流到容灾系统）
    5、容灾演练（租户可自行通过人工方式和使用脚本的方式进行容灾演练，或基于第三方软件进行容灾演练。）

    
    应用级热备（持久化数据涉及到的资源提前申请好，并同步应用数据到容灾Region），这套环境日常启动，但可以不接业务流量）
    容灾搭建
        1、署架构与生成环境保持一致，并同步应用数据导容灾Region
        2、数据同步：持久化数据需要复制到容灾环境，应用层发版发包到多地域容灾环境，保证生产与容灾环境一致性
        3、业务流量：容灾环境使用独立域名，且流量内部流转，
    业务侧要求：
        1、应用启动：DB启动只读状态的应用可以启动，可访问
        2、数据RPO: 应用无大事务，需要保证RPO
        3、消息： MQS可通过配置，打开会关闭消息的消费，且配置后生效
        4、定时任务：定时任务根据需要配置启停（容灾环境）
        5、缓存数据：不建议使用Redis作为本地存储
        6、资源占用：不同应用不建议使用共用数据库
        7、数据补偿：故障场景下有数据补偿拉齐方案
        8、容灾环境有效：业务对自身应用的容灾有效性负责

        

数据库容灾(分钟或小时级RPO,小时级RTO)
    仅对数据库进行容灾，不要求对应用进行容灾；持久化数据实施异地复制：结合业务目标，对生产备份数据进行复制
    存储及服务、中间件复制；容灾环境只需保留最低、可保证正常数据同步的资源;
    容灾演练与切换：
        对复制的数据完整性进行验证，确保数据有效，可快速恢复;利用复制的数据，以及申请相关的资源，将应用环境搭建起来，验证其功能是否正常



云上容灾（跨AZ容灾 RPO=0,RTO < 30min）：
    容灾系统部署在同一个Region 另一个的AZ中，当业务所在AZ发生故障时，可以快速切换到容灾系统上，两个AZ都在同一个城市，优点是网络切换时延低，数据同步速度快（RPO等于0，RTO小于30分钟）不足是在极端异常情况下，同一城市的整个数据中心发生故障时，无法起到容灾的作用。

云上容灾（跨Region容灾 RPO>30min，RTO > 4h）：
    容灾系统部署在另一个Region，业务发生故障时，业务快速切换到容灾环境

两地三中心（同一Region，RPO=0 RTO<30min;跨Region,RPO < 30min,RTO > 4h）：
    结合跨AZ同步复制以及OBS跨Region能力，其中业务系统部署在同一Region 的不同AZ上，容灾部署在另外一个Region上，可以通过过跨AZ的复制能力，提升业务系统的可靠性，同时又通过跨Region的容灾能力，有效应对地域性灾难。



容灾恢复演练：SDRS一键切换容灾，租户可自行通过人工方式和使用脚本的方式进行容灾演练，或基于第三方软件进行容灾演练。


IT应用系统，应用系统和mysql 均热备容灾到华为云上，生产数据中心和华为云之间使用专线进行网络连接；发生灾难时，用户需要将原生产数据中心的业务故障转移到容灾端（即华为云），并将业务流量的请求引流到华为云上ELB，实现应用系统的业务连续性。待云下的生产数据中心恢复后，云上MySQL的数据会自动同步至云下的MySQL，从而将华为云上的业务应用数据同步到云下的生产数据中心。用户也可根据计划将生产站点切回到云下的生产数据中心，实现云下的生产数据中心与华为云之间互相容灾切换，实现应用系统的业务跨云热备容灾效果

应用系统容灾：英方i2软件系统（工作机、灾备机、控制机）
数据库容灾：使用数据库自身复制技术，将数据库的数据复制到华为云的云服务器上。在华为云上，应用系统与数据库属于同一个VPC，可通过子网互通。当用户的生产数据中心发生故障时，应用系统和数据库切换到华为云数据中心，保证业务连续稳定。

MySQL Replation 异步复制

应用级别容灾改造：
    1、使用DNS服务器切换的方案，DNS解析
    2、使用LB切换方案






存储容灾服务SDRS(为ECS和OVS提供跨AZ/跨Region容灾的服务；通过主机层复制、容灾演练、网络迁移和缓存加速等多项技术)
支持在线一键容灾演练；模拟真实故障恢复场景，制定应急预案，故障发生时，通过应急预案快速恢复业务
，提高业务连续性；

支持一键式执行切换操作，在容灾站点自动创建、部署、拉起云服务器，并挂载包含最新数据的容灾盘，仅需用户少量配置即可恢复业务


容灾和备份的区别：
    容灾主要应对数据中心软硬件故障或重大自然灾害，生产站点和容灾站点之间通常会保持一定的安全距离，支持同城或异地；备份主要针对人为误操作、病毒感染、逻辑错误等因素，用于业务系统的数据恢复，数据备份一般在同一数据中心进行。
    容灾系统不仅保护数据，更重要的目的在于保证业务的连续性；而数据备份系统只保护不同时间点版本数据的可恢复。一般首次备份为全量备份，所需的备份时间会比较长，而后续增量备份则在较短时间内就可完成。
    容灾可实现低至秒级的RPO；备份可设置一天最多24个不同时间点的自动备份策略，后续可将数据恢复至不同的备份点。
    故障情况下（例如地震、火灾、数据中心故障），容灾系统的切换时间一般为分钟级；而备份系统的恢复时间可能几小时到几十小时。


异步复制
    1、搭建云上容灾专有网络
        公网：适合数据量变化不大，且无需频繁访问的数据
        vpn： 适合数据量不大，本地数据中心随时访问华为云的场景。
        专线：数据量大且复杂的场景，通常需要根据业务的具体变化量进行规划
    2、创建站点复制对
    3、部署云容灾网关(云容灾网关将生产站点所有被容灾的服务器上的数据进行汇聚和压缩加密，并同步到容灾站点)
    4、下载并安装代理软件
    5、创建保护实例


案例：

两地三中心（存储容灾服务SDRS+云备份CBR）
两地三中心容灾方案（SDRS+CBR）通过SDRS将生产站点的数据同步复制到同区域下的不同可用区，形成跨可用区容灾站点；通过CBR将生产站点的数据周期性备份到不同区域，形成跨区域容灾站点。生产站点、跨可用区容灾站点、跨区域容灾站点共同组成两地三中心架构，满足两地三中心容灾方案的诉求。

SDRS+CBR容灾方案适用于使用弹性云服务器和云硬盘运行业务的场景

两地三中心容灾方案（SDRS+CBR）中，“两地”是指容灾方案部署在两个区域，“三中心”分别是一个生产站点、一个同区域跨可用区容灾站点（下文简称为跨可用区容灾站点）和一个跨区域容灾站点。

两地三中心容灾方案（SDRS+CBR）分别通过SDRS将生产站点的数据同步地复制到跨可用区容灾站点，通过CBR将生产站点的数据周期性地备份到跨区域容灾站点，满足两地三中心的诉求。


生产站点正常工作：

通过SDRS，在区域A内将可用区1的生产站点服务器的数据、配置信息同步复制到可用区2的跨可用区容灾站点，为跨可用区容灾做准备。日常可定期进行容灾演练，模拟真实故障恢复场景，制定应急恢复预案。
通过CBR，对位于区域A的生产站点服务器进行周期性整机备份，然后周期性将整机备份复制到区域B的跨区域容灾站点，为跨区域容灾做准备。



阿里云容灾演练服务（ahas）

演练服务：
    应用层：
        java（cpu满载、频繁gc、jvm、oom）;
        进程（多次杀进程、进程D状态、进程Z状态）
    接入层:  负载不可用、dns(篡改记录、域名解析异常)
    中间件：
        redis（redis 不通、redis 延时、redis连接数耗尽）
        nginx （nginx连接数耗尽、nginx磁盘打满、nginx重启、nginx 内存利用率高）
    服务层：容器（杀容器、停止、暂停、重启）；
    数据库层： 
        mysql（不通、延迟、连接池耗尽、慢sql）;
        mongoDB 连接池耗尽 
    资源层：
        主机（宕机、重启、cpu负载高、指定cpu占用，磁盘io高，磁盘耗尽，磁盘空间丢失、不可读写）
        网络（网卡故障、丢包、延时、延迟、网络包错误、抖动等）
        tcp (端口占用、连接重置)


上云迁移流程：
    迁移方案设计：评估业务系统，数据库、存储数据等信息，提供业务迁移方案；包含云上组网规划、基础环境资源、应用主机迁移、数据库迁移、存储数据迁移等方案，协助客户完成业务切换方案
    组网实施 
    基础环境迁移
    主机迁移
    数据迁移
    存储迁移
    业务压测
    业务保障切换

    项目启动会 -> 项目调研 ->规划设计 ->迁移实施 -> 项目验收


###########################
云迁移前需要做哪些准备？
    1、资产评估(了解当前现状，资源规模，技术栈，迁移限制、迁移云成本、相关业务合同)
    2、项目启动（识别干系人，确定项目实施计划和周期，明确项目范围、进度、风险、验收标准）
    3、系统架构的梳理与评估（梳理资源清单，盘点资产与建立拓扑）
    4、确定迁移方案（现网架构图）
    5、迁移方案
    6、迁移测试
    7、上线切割
    8、运维监控（运维文档）


云原生：
    容器化
    微服务
    devops
    cicd


阿里云产品提供哪些秘钥加密等功能？
    1、KMS加密；秘钥管理、生成、存储、使用和轮转秘钥，以及加密算法和密钥策略管理
    2、对象存储加密（OSS）,数据加密传输和服务端加密，kms进行自定义密钥加密
    3、数据加密服务（DESS）
    4、虚拟专网（VPC）
    5、容器服务（ACK）

Serverless架构:
    1、构建和运行不需要服务器管理的应用程序
    2、借助云产品提供的函数计算和事件触发功能

架构设计怎么和云产品结合：
    弹性扩缩容：云产品根据负载进行弹性伸缩，
    高可用：云产品提供有多个可用区和多个数据中心的部署选项，可以通过在不同区域数据中心间进
        行负载均衡和容灾备份，增加系统可用性
    容灾：云产品提供了跨地域的部署选项，可以在不同地理区域进行数据备份和容灾。在架构设
        计中，可以将关键数据进行异地备份。
    云原生架构：
        云原生架构设计是一种将应用程序设计为适应云环境的方式，借助云厂商提供的容器化、微服务、自动化管理的特性，可以实现可伸缩、可扩展、高度解耦的架构，以实现快速交付和、部署的优势。
    Serverless架构
    数据存储与分析

SLB：
    负载均衡算法（轮询、加权轮询、权重）
    高可用设计（主备可用区）
    网络冗余
    健康检查与探针
    动态负载均衡
    安全性设计
    日志与监控



等保三级：
    网络（ddos、scdn、云防火墙）
    主机（堡垒机、云安全管理、镜像加固）
    应用（web应用防火墙、证书服务、漏洞扫描）
    数据安全（加密服务、敏感数据保护、数据库审计）
    业务安全（风险识别、爬虫风险管理、人脸验证、双因子认证）
    安全管理（云安全管理、安全管家）

    
阿里云交付设计
    需求确认
    架构设计
    环境搭建
    应用部署
    安全设置
    数据迁移
    性能优化
    监控和运维
    交付验收
    培训与支持


读写分离：
    不修改代码，在控制台调整读权重比例，可实现流量按照权重比列在多个



本地IDC接入阿里云
    CEN
    VPN
    数据库网关
    NAT网关

MySQL主从同步、读写分离（高可用部署）：
    读写分离：数据库代理功能实现读写请求自动转发，



单体应用拆分多个微服务，通常涉及到服务接口需要重新设计，服务间通信机制（如Restful、GRPC或消息队列），以及微服务框架（Spring Cloud,Dubbo）
